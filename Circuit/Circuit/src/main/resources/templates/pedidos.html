<!DOCTYPE html>
<html lang="pt-BR" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments/head.html :: head(titulo = 'Novo Pedido de Compra')}">
</head>
<body>

<div th:replace="~{fragments/menu :: sidebar('pedidos')}"></div>

<div class="main-content">

    <header th:replace="~{fragments/header :: header}"></header>

    <div class="content">

        <div class="page-header">
            <div>
                <h1 class="page-title">Novo Pedido de Compra</h1>
            </div>
            <div class="header-actions">
                <a href="/pedidos" class="btn-secondary flex-center">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="mr-5"><line x1="19" y1="12" x2="5" y2="12"></line><polyline points="12 19 5 12 12 5"></polyline></svg>
                    Voltar
                </a>
            </div>
        </div>

        <form th:action="@{/pedidos/salvar}" method="POST" id="formPedido" class="w-100">

            <div class="table-card p-25">
                <div class="status-header">
                    <h3>Dados Gerais</h3>
                </div>

                <div class="form-grid-4">
                    <div class="form-group">
                        <label>N√∫mero do Pedido</label>

                        <div class="input-wrapper-btn">
                            <input type="text" id="numeroPedido" class="form-control input-readonly">

                            <button type="button" class="btn-inside" onclick="gerarCodigoHex()" title="Gerar novo c√≥digo">
                                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M2 18h1.4c1.3 0 2.5-.6 3.3-1.7l6.1-8.6c.7-1.1 2-1.7 3.3-1.7H22"/>
                                    <path d="m18 2 4 4-4 4"/>
                                    <path d="M2 6h1.9c1.5 0 2.7.9 3.6 2.2"/>
                                    <path d="M22 18h-5.9c-1.3 0-2.6-.7-3.3-1.8l-.5-.8"/>
                                    <path d="m18 14 4 4-4 4"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <div class="form-group span-2">
                        <label>Fornecedor <span class="text-danger">*</span></label>
                        <select class="form-control" id="selectFornecedor" name="fornecedorId" required onchange="atualizarDadosFornecedor(this)">
                            <option value="">Selecione um fornecedor...</option>
                            <option th:each="f : ${listaFornecedores}"
                                    th:value="${f.id}"
                                    th:text="${f.nomeFantasia}"
                                    th:data-cnpj="${f.cnpj}"
                                    th:data-cod="${f.id}">
                            </option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>CNPJ / C√≥d.</label>
                        <input type="text" id="inputCnpjFornecedor" class="form-control input-bg" placeholder="Dados do fornecedor..." readonly>
                    </div>

                    <div class="form-group">
                        <label>Data do Pedido</label>
                        <input type="date" class="form-control" name="dataPedido" th:value="${#dates.format(#dates.createNow(), 'yyyy-MM-dd')}" required>
                    </div>

                    <div class="form-group">
                        <label>Prev. Entrega</label>
                        <input type="date" class="form-control" name="dataEntrega">
                    </div>

                    <div class="form-group">
                        <label>Status</label>
                        <select class="form-control font-600 text-main" name="status">
                            <option value="RASCUNHO" selected>üìù Rascunho</option>
                            <option value="ENVIADO">üì® Enviado</option>
                            <option value="CONFIRMADO">‚úÖ Confirmado</option>
                            <option value="RECEBIDO">üì¶ Recebido</option>
                            <option value="RECEBIDO_PARCIAL">‚ö†Ô∏è Parcial</option>
                            <option value="CANCELADO">‚ùå Cancelado</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>Respons√°vel</label>
                        <div class="user-display">
                            <div class="user-avatar-small">AD</div>
                            <span class="font-600 text-sm">Admin (Voc√™)</span>
                        </div>
                    </div>
                </div>
            </div>

            <div class="table-card mt-20">
                <div class="card-header-simple">
                    <h3 class="flex-center gap-5 text-white">
                        Itens do Pedido
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="9" cy="21" r="1"></circle><circle cx="20" cy="21" r="1"></circle><path d="M1 1h4l2.68 13.39a2 2 0 0 0 2 1.61h9.72a2 2 0 0 0 2-1.61L23 6H6"></path></svg>
                    </h3>
                    <button type="button" class="btn-primary flex-center gap-5" onclick="adicionarLinhaItem()">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                        Adicionar Produto
                    </button>
                </div>

                <div class="table-responsive">
                    <table class="data-table" id="tabelaItens">
                        <thead>
                        <tr>
                            <th style="width: 25%; padding-left: 35px">Produto</th>
                            <th style="width: 25%; padding-left: 35px">Qtd.</th>
                            <th style="width: 25%; padding-left: 35px">Valor Unit.</th>
                            <th style="width: 25%; padding-left: 35px">Total</th>
                        </tr>
                        </thead>
                        <tbody id="tbodyItens">
                        <tr class="linha-item">
                            <td>
                                <select class="form-control" name="itens[0].produtoId" onchange="atualizarPreco(this)">
                                    <option value="">Selecione...</option>
                                    <option th:each="p : ${listaProdutos}" th:value="${p.id}" th:text="${p.nome}" th:data-preco="${p.precoCusto}"></option>
                                </select>
                            </td>
                            <td>
                                <input type="number" class="form-control text-center" name="itens[0].quantidade" value="1" min="1" oninput="calcularLinha(this)">
                            </td>
                            <td>
                                <div class="input-money-wrapper">
                                    <span class="currency-prefix">R$</span>
                                    <input type="text" class="money-input" name="itens[0].valorUnitario" value="0,00" oninput="calcularLinha(this)">
                                </div>
                            </td>
                            <td>
                                <input type="text" class="input-money-wrapper" value="R$ 0,00" readonly>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <div class="pedido-footer-layout">
                <div class="footer-totals-widget">

                    <div class="widget-row">
                        <span>Subtotal</span>
                        <strong id="spanSubtotal">R$ 0,00</strong>
                    </div>

                    <div class="widget-row">
                        <span>Frete / Extras</span>
                        <div class="widget-input-wrapper">
                            <span>R$</span>
                            <input type="text" id="inputFrete" name="valorFrete" value="0,00" oninput="calcularTotalFinal()">
                        </div>
                    </div>

                    <div class="widget-divider"></div>

                    <div class="widget-total-row">
                        <span class="total-label">Total do Pedido</span>
                        <span class="total-value" id="spanTotalFinal">R$ 0,00</span>
                    </div>

                    <div class="widget-actions-row">
                        <a href="/pedidos" class="btn-secondary btn-block text-center no-decoration">Cancelar</a>
                        <button type="submit" class="btn-primary btn-block justify-center">
                            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"></path><polyline points="17 21 17 13 7 13 7 21"></polyline><polyline points="7 3 7 8 15 8"></polyline></svg>
                            Salvar Pedido
                        </button>
                    </div>
                </div>
            </div>

        </form>
    </div>
</div>

<script th:src="@{/js/pedido.js}"></script>
</body>
</html>